
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Package Developer Notes &#8212; Machine Common Sense  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Running Remotely" href="remotely.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="remotely.html" title="Running Remotely"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Machine Common Sense  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Package Developer Notes</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="package-developer-notes">
<h1>Package Developer Notes<a class="headerlink" href="#package-developer-notes" title="Permalink to this heading">¶</a></h1>
<section id="package-installation">
<h2>Package Installation<a class="headerlink" href="#package-installation" title="Permalink to this heading">¶</a></h2>
<section id="create-a-virtual-environment">
<h3>Create a Virtual Environment<a class="headerlink" href="#create-a-virtual-environment" title="Permalink to this heading">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python3.7<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>--prompt<span class="w"> </span>mcs<span class="w"> </span>venv
<span class="gp">$ </span><span class="nb">source</span><span class="w"> </span>venv/bin/activate
<span class="gp gp-VirtualEnv">(mcs)</span> <span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>pip<span class="w"> </span>setuptools<span class="w"> </span>wheel
</pre></div>
</div>
</section>
<section id="install-the-mcs-package-and-dependencies">
<h3>Install the MCS Package and dependencies<a class="headerlink" href="#install-the-mcs-package-and-dependencies" title="Permalink to this heading">¶</a></h3>
<p>Install the packages included in the requirements file so that linting and documentation work. The requirements.txt file includes developer and package dependencies.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(mcs)</span> <span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</pre></div>
</div>
<p>From the MCS root folder, install the package in your virtual environment in editable mode (-e) so that local changes will automatically reflect in the virtual environment.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(mcs)</span> <span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>.
</pre></div>
</div>
</section>
<section id="run-pre-commit">
<h3>Run pre-commit<a class="headerlink" href="#run-pre-commit" title="Permalink to this heading">¶</a></h3>
<p>Run pre-commit install to set up the git hooks for linting and auto-documentation.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(mcs)</span> <span class="gp">$ </span>pre-commit<span class="w"> </span>install
</pre></div>
</div>
</section>
</section>
<section id="linting">
<h2>Linting<a class="headerlink" href="#linting" title="Permalink to this heading">¶</a></h2>
<p>We are currently using <a class="reference external" href="https://flake8.pycqa.org/en/latest/">flake8</a> and <a class="reference external" href="https://pypi.org/project/autopep8/">autopep8</a> for linting and formatting our Python code. This is enforced within the python_api and scene_generator projects. Both are <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">PEP 8</a> compliant (besides some inline exceptions), although we are ignoring the following rules:
- <strong>E402</strong>: Module level import not at top of file
- <strong>W504</strong>: Line break occurred after a binary operator</p>
<p>A full list of error codes and warnings enforced can be found <a class="reference external" href="https://flake8.pycqa.org/en/latest/user/error-codes.html">here</a></p>
<p>Both have settings so that they should run on save within Visual Studio Code <a class="reference external" href="https://github.com/NextCenturyCorporation/MCS/blob/master/.vscode/settings.json">settings.json</a> as well as on commit after running <cite>pre-commit install</cite> (see <a class="reference external" href="https://github.com/NextCenturyCorporation/MCS/blob/master/.pre-commit-config.yaml">.pre-commit-config.yaml</a> and <a class="reference external" href="https://github.com/NextCenturyCorporation/MCS/blob/master/.flake8">.flake8</a>), but can also be run on the command line:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(mcs)</span> <span class="gp">$ </span>flake8
</pre></div>
</div>
<p>and</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(mcs)</span> <span class="gp">$ </span>autopep8<span class="w"> </span>--in-place<span class="w"> </span>--aggressive<span class="w"> </span>--recursive<span class="w"> </span>&lt;directory&gt;
</pre></div>
</div>
<p>or</p>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this heading">¶</a></h2>
<p>See our <a class="reference external" href="https://github.com/NextCenturyCorporation/MCS/blob/master/tests/README.md">tests README</a></p>
</section>
<section id="sphinx-documentation">
<h2>Sphinx Documentation<a class="headerlink" href="#sphinx-documentation" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Good Sphinx Tutorial: <a class="reference external" href="https://medium.com/&#64;richdayandnight/a-simple-tutorial-on-how-to-document-your-python-project-using-sphinx-and-rinohtype-177c22a15b5b">https://medium.com/&#64;richdayandnight/a-simple-tutorial-on-how-to-document-your-python-project-using-sphinx-and-rinohtype-177c22a15b5b</a></p></li>
<li><p>Markdown Builder: <a class="reference external" href="https://pypi.org/project/sphinx-markdown-builder/">https://pypi.org/project/sphinx-markdown-builder/</a></p></li>
<li><p>Sphinx: <a class="reference external" href="https://www.sphinx-doc.org/en/master/">https://www.sphinx-doc.org/en/master/</a></p></li>
<li><p>Sphinx’s own Tutorial: <a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/quickstart.html">https://www.sphinx-doc.org/en/master/usage/quickstart.html</a></p></li>
</ul>
<p>To generate the Sphinx documentation locally, from the docs folder:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(mcs)</span> <span class="gp">$ </span>make<span class="w"> </span>html
</pre></div>
</div>
</section>
<section id="python-style-guide">
<h2>Python Style Guide<a class="headerlink" href="#python-style-guide" title="Permalink to this heading">¶</a></h2>
<p>See <a class="reference external" href="https://numpydoc.readthedocs.io/en/latest/format.html">https://numpydoc.readthedocs.io/en/latest/format.html</a></p>
</section>
<section id="running">
<h2>Running<a class="headerlink" href="#running" title="Permalink to this heading">¶</a></h2>
<p>We have made multiple run scripts:</p>
<p>To run a script (like <cite>run_human_input.py</cite>) from the terminal with visual output:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(mcs)</span> <span class="gp">$ </span>run_in_human_input_mode<span class="w"> </span>&lt;mcs_unity_build_file&gt;<span class="w"> </span>&lt;mcs_config_json_file&gt;
</pre></div>
</div>
<p>To run it headlessly, first install xvfb (on Ubuntu, run <cite>sudo apt-get install xvfb</cite>), then:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(mcs)</span> <span class="gp">$ </span>xvfb-run<span class="w"> </span>--auto-servernum<span class="w"> </span>--server-args<span class="o">=</span><span class="s1">&#39;-screen 0 640x480x24&#39;</span><span class="w"> </span>python3<span class="w"> </span>run_human_input.py<span class="w"> </span>&lt;mcs_unity_build_file&gt;<span class="w"> </span>&lt;mcs_config_json_file&gt;
</pre></div>
</div>
<p>Each run will generate a subdirectory (named based on your config file) containing the output image files from each step.</p>
</section>
<section id="making-gifs">
<h2>Making GIFs<a class="headerlink" href="#making-gifs" title="Permalink to this heading">¶</a></h2>
<p>First, install ffmpeg. Then (change the frame rate with the <cite>-r</cite> option):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ffmpeg<span class="w"> </span>-r<span class="w"> </span><span class="m">3</span><span class="w"> </span>-i<span class="w"> </span>frame_image_%d.png<span class="w"> </span>output.gif
</pre></div>
</div>
</section>
<section id="testing-topdown-plots">
<h2>Testing TopDown Plots<a class="headerlink" href="#testing-topdown-plots" title="Permalink to this heading">¶</a></h2>
<p>The plotter module has a main which is only executed when the plotter module is run directly vs imported. The developer can provide a scene file as a positional argument and the plotter’s main will run with video_enabled for 1 step. This will create a visual, depth and topdown video in a scene folder for quick review.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>venv<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>python<span class="w"> </span>plotter.py<span class="w"> </span>playroom.json
</pre></div>
</div>
</section>
<section id="more-config-options">
<h2>More Config Options<a class="headerlink" href="#more-config-options" title="Permalink to this heading">¶</a></h2>
<p>Outlined here is a list of config file options that can be used <strong>in addition</strong> to the ones listed under the <a class="reference internal" href="install.html#mcs-config-file"><span class="std std-ref">MCS Configuration File</span></a> section.</p>
<p>To use a specific configuration, you can either pass in a file path or dictionary of values via the <cite>config_file_or_dict</cite> in the create_controller() method, or set the <cite>MCS_CONFIG_FILE_PATH</cite> environment variable to the path of your MCS configuration file (note that the configuration must be an INI file – see <a class="reference external" href="https://github.com/NextCenturyCorporation/MCS/blob/master/sample_config.ini">sample_config.ini</a> for an example).</p>
<p>The <cite>MCS_CONFIG_FILE_PATH</cite> environment variable is meant for use by the TA2 team during evaluation.</p>
<section id="developer-config-file-properties">
<h3>Developer Config File Properties<a class="headerlink" href="#developer-config-file-properties" title="Permalink to this heading">¶</a></h3>
<section id="evaluation-name">
<h4>evaluation_name<a class="headerlink" href="#evaluation-name" title="Permalink to this heading">¶</a></h4>
<p>(string)</p>
<p>Identifier to add to scene history and video files (default: ‘’).</p>
</section>
<section id="team">
<h4>team<a class="headerlink" href="#team" title="Permalink to this heading">¶</a></h4>
<p>(string)</p>
<p>Team name identifier to prefix to scene history and video files (default: ‘’).</p>
</section>
</section>
</section>
<section id="handling-pull-requests-from-contributors">
<h2>Handling Pull Requests From Contributors<a class="headerlink" href="#handling-pull-requests-from-contributors" title="Permalink to this heading">¶</a></h2>
<p>Checkout the pull request from github</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>fetch<span class="w"> </span>origin<span class="w"> </span>+refs/pull/&lt;pull#&gt;/merge
</pre></div>
</div>
<p>If there are any package dependency changes, create a new virtual environment using the initialization steps above. Even if there aren’t, it would be a good to start with a fresh environment anyway.</p>
<p>Run the unit tests locally</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(mcs)</span> <span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>unittest
</pre></div>
</div>
<p>If the unit tests pass, then ensure the new code is solves the issue in the PR and follows our coding conventions.</p>
<p>Be sure that PEP-8 formatting is correct or is easily fixable.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(mcs)</span> <span class="gp">$ </span>flake8
</pre></div>
</div>
<p>After iterating with the contributor, if you feel the PR is reasonably close, feel free to approve the PR, merge, and fix any lingering issues.</p>
</section>
<section id="releases">
<h2>Releases<a class="headerlink" href="#releases" title="Permalink to this heading">¶</a></h2>
<p>Please see the following <a class="reference external" href="https://nextcentury.atlassian.net/wiki/spaces/MCS/pages/1442742340/MCS+Release+Procedures">Confluence page</a></p>
</section>
<section id="depth-map-data">
<h2>Depth Map Data<a class="headerlink" href="#depth-map-data" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>In <cite>machine_common_sense/step_metadata.py</cite>, in the <cite>StepMetadata</cite> class, in the <cite>__iter__</cite> function, add <cite>yield ‘depth_map_list’, self.depth_map_list</cite> in order to save the depth map data in debug output files.</p></li>
<li><p>Run a scene with <cite>debug</cite> set to <cite>true</cite> and <cite>metadata</cite> NOT set to <cite>none</cite>.</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(mcs)</span> <span class="gp">$ </span>python<span class="w"> </span>machine_common_sense/scripts/run_human_input.py<span class="w"> </span>--config_file<span class="w"> </span>machine_common_sense/scripts/config_level1_debug.ini<span class="w"> </span>docs/source/scenes/playroom.json
</pre></div>
</div>
<ul class="simple">
<li><p>Open one of the debug <cite>mcs_output</cite> files (like <cite>playroom/mcs_output_0.json</cite>) to see the <cite>depth_map_list</cite></p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Package Developer Notes</a><ul>
<li><a class="reference internal" href="#package-installation">Package Installation</a><ul>
<li><a class="reference internal" href="#create-a-virtual-environment">Create a Virtual Environment</a></li>
<li><a class="reference internal" href="#install-the-mcs-package-and-dependencies">Install the MCS Package and dependencies</a></li>
<li><a class="reference internal" href="#run-pre-commit">Run pre-commit</a></li>
</ul>
</li>
<li><a class="reference internal" href="#linting">Linting</a></li>
<li><a class="reference internal" href="#testing">Testing</a></li>
<li><a class="reference internal" href="#sphinx-documentation">Sphinx Documentation</a></li>
<li><a class="reference internal" href="#python-style-guide">Python Style Guide</a></li>
<li><a class="reference internal" href="#running">Running</a></li>
<li><a class="reference internal" href="#making-gifs">Making GIFs</a></li>
<li><a class="reference internal" href="#testing-topdown-plots">Testing TopDown Plots</a></li>
<li><a class="reference internal" href="#more-config-options">More Config Options</a><ul>
<li><a class="reference internal" href="#developer-config-file-properties">Developer Config File Properties</a><ul>
<li><a class="reference internal" href="#evaluation-name">evaluation_name</a></li>
<li><a class="reference internal" href="#team">team</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#handling-pull-requests-from-contributors">Handling Pull Requests From Contributors</a></li>
<li><a class="reference internal" href="#releases">Releases</a></li>
<li><a class="reference internal" href="#depth-map-data">Depth Map Data</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="remotely.html"
                          title="previous chapter">Running Remotely</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/dev.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="remotely.html" title="Running Remotely"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Machine Common Sense  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Package Developer Notes</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, CACI.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.3.
    </div>
  </body>
</html>